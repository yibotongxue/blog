# 线性规划

线性规划是一个重要的算法分析问题，本文介绍其相关之内容。

## 线性规划问题的一般形式

用高度概括的语言来说，线性规划旨在求解一个符合一定线型约束条件的、使得一个线性运算结果最大或最小化的向量。其一般形式可以表示为

$$
\begin{split}
min(max) z = \sum\limits_{j=1}c_jx_j \\
s.t. \sum\limits_{j=1}^na_{ij}x_j \le(=,\ge)b_i, i=1,2,...,m \\
x_j \ge 0, j\in J \subset\{1,2,...,n\} \\
x_j 任意， j\in\{1,2,...,n\}-J
\end{split}
$$

分别为**目标函数**，**约束条件**，**非负条件**和**自由变量**。

我们定义：

- **可行解**：满足约束条件和非负条件的变量
- **可行域**：全体可行解
- **最优解**：目标函数最小（最大）的可行解
- **最优值**：最优解的目标函数值

一般的，线性规划问题的解可能存在以下即种情况：

1. 有唯一的最优解
2. 有无穷多个最优解
3. 有可行解，但无最优解
4. 无可行解，更无最优解

所谓的线性规划问题，当 $n=2$ 的时候便是我们中学常遇到之问题，通常我们采用图解法，如果有唯一最优解，一般为两条直线的交点。

## 线性规划问题的标准形

通过一系列的调整，所有的线性规划问题可以转换为一个标准形，其定义如下：

$$
\begin{split}
min z = \sum\limits_{j=1}^nc_jx_j \\
s.t. \sum\limits_{j=1}^na_{ij}x_j = b_i, i = 1,2,...,m \\
x_j \ge 0, j = 1,2,...,n
\end{split}
$$

其中 $b_i \ge 0, i=1,2,...,m$

概括地说，就是所有的约束都是等式且等式右边都是非负数，所有的变量都是非负，而需要最小化目标函数。线性规划的一般形式转化成标准形，可以按照如下的步骤进行：

1. 凡是最大化的，即 $max z = \sum\limits_{j=1}^nc_jx_j$ ，统一修改为 $min z' = \sum\limits_{j=1}^n-c_jx_j$ ，亦即取 $z' = -z$ ， $c'_j = -c_j$
2. 所有 $b_i \lt 0$ 的约束，两边同时添加负号，是不等式的，反转不等号方向
3. 所有的 $\sum\limits_{j=1}^na_{ij}x_j \le b_i$ ，添加一个**松弛变量** $y_i \ge 0$ ，修改约束条件为 $\sum\limits_{j=1}^na_{ij}x_j + y_i = b_i$ 。
4. 所有的 $\sum\limits_{j=1}^na_{ij}x_j \ge b_i$ ，添加一个**剩余变量** $y_i \ge 0$ ，修改约束条件为 $\sum\limits_{j=1}^na_{ij}x_j - y_i = b_i$ 。
5. 所有的自由变量 $x_j$ 替换为 $x'_j - x''_j$ ，并添加两个非负条件 $x'_j \ge 0$ ， $x''_j \ge 0$ 。

转化成标准形后，我们用矩阵表示之，令

$$
A = \left[
\begin{matrix}
a_{11} & a_{12} & ... & a_{1n} \\
a_{21} & a_{22} & ... & a_{2n} \\
... \\
a_{m1} & a_{m2} & ... & a_{mn} \\
\end{matrix}
\right], b = \left[
    \begin{matrix}
    b_1 \\
    b_2 \\
    \\
    b_m
    \end{matrix}
\right],
c = \left[
    \begin{matrix}
    c_1 \\
    c_2 \\
    \\
    c_n
    \end{matrix}
\right],
x = \left[
    \begin{matrix}
    x_1 \\
    x_2 \\
    \\
    x_n
    \end{matrix}
\right]
$$

标准形则为

$$
\begin{split}
min z = c^Tx \\
s.t. Ax = b \\
x \ge 0
\end{split}
$$

所求之 $x$ ，亦可理解为 $A$ 列向量表出 $b$ 之全非负系数。如果存在可行解，那么 $b$ 可被 $A$ 列向量表出，考虑 $A$ 列向量的一组**基向量**，则 $b$ 同样可由这组基向量表出，并且系数唯一，如果系数全为非负，则这组基向量成为**可行基**，将 其他非基向量的系数定义为 $0$ ，得到的可行解成为**基本可行解**。

有如下定理成立：

:::info **定理**
如果标准形有可行解，则必有基本可行解。
:::

:::info **定理**
如果标准形有最优解，则一定存在一个基本可行解是最优解。
:::

## 单纯形法

根据上面的分析，寻找线性规划问题的最优解，可以将其转化为标准形，然后在基本可行解中寻找最优者，即遍历所有可能的基向量组合，求解之，凡是系数全为非负的均为可行解，择其目标函数最小者即为最优可行解。一个标准形，最多可能有 $C_n^m$ 个基，之多有 $C_n^m$ 个基本解，遍历之的效率过低，为此，我们介绍一个常用的线性规划算法——单纯形法。

高度概括地说，单纯形法即从一个初始基本可行解出发，不断替换基向量，使得目标函数下降或者不变，直至找到最优解。与穷举法不同的是，单纯形法通过迭代的方法得到最优解，效率更高。这里存在几个关键问题：

1. 初始基本可行解如何得到？
2. 如何判断是否找到了最优解？
3. 如何替换基向量才能使得目标函数下降或者不变？

### 确定初始基本可行解

确定初始基本可行解，本质上只需要确定一组可行基。我们可以按照如下的方法确定可行基：

1. 通过添加松弛变量得到标准形的约束条件，添加的松弛变量代表的列向量作为可行基的一个向量
2. 通过添加剩余变量得到标准形或者既为标准形的约束条件，添加一个**人工变量**，并以这个人工变量代表的列向量作为可行基的一个向量

人工向量的添加十分简单，将 $\sum\limits_{j=1}^na_{ij}x_j = b_i$ 修改为 $\sum\limits_{j=1}^na_{ij}x_j + y_i = b_i$ ， 其中 $y_i \ge 0$ 即为人工变量。

这里存在一个问题，我们引入的人工变量可能导致得到的基本可行解不是原问题的可行解，除非这个基本可行解中所有的人工变量取值都为 $0$ ，亦即经过基向量替换后最终得到的最优解的基向量不包含人工变量的向量。为此，对于引入的人工变量 $y_1,...,y_m$ ，我们引入一个辅助问题：

$$
\begin{split}
min w = \sum\limits_{i=1}^m y_i \\
s.t. \sum\limits_{j=1}^na_{ij}x_j = b_i, 1 \le i \le m \\
x_j \ge 0, 1 \le j \le n \\
y_i \ge 0, 1 \le i \le m
\end{split}
$$

这是一个线性规划问题，我们可以求得其最优解，如果最优函数值 $w* \gt 0$ ，则原问题无可行解，如果 $w* = 0$ ，我们讨论两种情况：

1. 如果最优解中所有的人工变量都是非基变量，那么有 $y*_1 = ... = y*_m = 0$ ，这时 $(x*_1,...,x*_n)^T$ 即为元问题的基本可行解。
2. 如果基变量中含有人工变量，我们很容易证明可以通过基变换得到新的最优解，使得人工变量都是非基变量。考虑一个问题，如果一个人工变量对应的向量是基向量，那么考虑所有的非基向量在这组基向量下的坐标对应这个人工变量的分量，显然所有的人工变量对应的分量必然为 $0$ ，如果所有的非人工变量的系数也为 $0$ ，这意味着该变量所添加在的原约束条件事实上可以被原来其他的约束条件线性表出，我们直接删除这个条件，从而删除了这个人工变量；如果存在非人工变量对应的系数不为 $0$ ，那么我们可以用这个非人工变量替换这个人工变量。总之，我们总能减少基向量中人工变量的个数，最终使得基向量中不包含人工变量，此时 $(x*_1,...,x*_n)^T$ 即为原问题的基本可行解。

### 最优性检验

判断一个基本可行解是否为最优解，关键在于判断是否可能通过基变换降低目标函数的值，教材的方法是引入一个检验数来实现，其核心原理在于讨论任意的其他可行解对应的目标函数值与当前的基本可行解对应的目标函数值，如果存在更低的可能，则认为当前的基本可行解不是最优解，否则认为当前的基本可行解就是最优解。

具体的，对于任何的可行解 $x$ ，有 $Ax = b$ ，考虑可行基组成的矩阵 $B$ ，我们通过实现删除线型相关的约束条件，可以使得这里得到的 $B$ 是方阵，从而存在逆矩阵，两边同时左乘 $B^{-1}$ ，得

$$
B^{-1}Ax = B^{-1}b
$$

将 $A$ 分为两个部分，基向量组成的矩阵 $B$ 和和非基向量组成的矩阵 $N$ ，对应的 $x$ 亦分为两个部分，基变量组成的向量 $x_B$ 和非基变量组成的向量 $x_N$ ，则上是可以写作

$$
x_B + B^{-1}Nx_N = B^{-1}b
$$

解得：

$$
x_B = B^{-1}b - B^{-1}Nx_N
$$

这里的含义是，我们可以用非基变量表示基变量，代入目标函数，得

$$
\begin{align}
z &= c^Tx \\
&= c_B^Tx_B + c_N^Tx_N \\
&= c_B^T(B^{-1}b - B^{-1}Nx_N) + c_N^Tx_N \\
&= c_B^TB^{-1}b + (c_N^T-c_B^TB^{-1}N)x_N
\end{align}
$$

对于基本可行解， $x_N = 0$ ，从而 $z_0 = c_B^TB^{-1}b$ ，故上式可以写作

$$
z = z_0 + (c_N^T-c_B^TB^{-1}N)x_N
$$

所以我们只需要判断 $(c_N^T-c_B^TB^{-1}N)x_N$ 是否可能小于零。注意到

$$
\begin{align}
(c_N^T-c_B^TB^{-1}N)x_N &= (c_B^T-c_B^TB^{-1}B)x_B + (c_N^T-c_B^TB^{-1}N)x_N \\
&= (c^T-c_B^TB^{-1}A)x
\end{align}
$$

令

$$
\lambda = c^T-c_B^TB^{-1}A
$$

即有

$$
z = z_0 + \lambda^Tx
$$

注意到 $x$ 每个分量必须为非负，故我们只需要判断 $\lambda$ 是否存在负分量。我们称 $\lambda$ 的分量 $\lambda_1,\lambda_2,...,\lambda_n$ 为检验数。显然，对应基向量的检验数必为 $0$ 。记 $B^{-1}A = (\alpha_{ij})_{m\times n}$ ， $P'_{j} = B^{-1}P_j = (\alpha_{1j},\alpha_{2j},...,\alpha_{mj})^T(1\le j \le n)$ ， $\beta = B^{-1}b$ 。很容易注意到以下定理成立

:::info 定理
给定基本可行解 $x^{(0)}$ ，如果所有的检验数大于等于 $0$ ，则 $x^{(0)}$ 是最优解。如果存在一个检验数 $\lambda_k \lt 0$ 且所有 $\alpha_{ik} \le 0(1\le i \le m)$ ，则无最优解。
:::

第一个结论是显然的，第二个结论不是那么显然，这里不作严格的证明，而是给出一个形象的理解。显然 $x_k$ 不是基变量（因为对应基向量的检验数必为 $0$ ），如果所有的 $\alpha_{ik} \le 0(1\le i \le m)$ ，这相当于一个非基向量（对于式子 $B^{-1}Ax = B^{-1}b$）的所有分量全为非正数，显然的，我们令 $x_k$ 为 $M \lt 0$，其他的非基变量为 $0$ ，而其他的基变量取对应的 $\beta_i - \alpha_{ik}M \ge 0, 1 \le i \le m$ ，即构成原来的一个可行解，其目标函数值为

$$
z = z_0 + \lambda_kM
$$

令 $m \to +\infty$ 是， $z \to -\infty$ ，原问题无最优解。

对于其他的情况，我们判断当前的基本可行解不是最优解。

### 基变换

所谓的基变换，实际上就是将原来的基本可行解的基替换成另一组基，求出新的基本可行解，并使目标函数值下降或不变。一般的，我们称用来替换基变量的非基变量为**换入变量**，被替换的基变量成为**换出变量**。这里存在的问题是，我们如何确定这两个变量，以确保新的变量组对应的向量仍然构成一组基，并且目标函数值下降或不变。

我们假设 $\lambda_k \lt 0$ 且 $\alpha_{lk} \gt 0$ ，选择 $x_k$ 为换入变量， $x_{\pi(l)}$ 为换出变量，其中 $x_{\pi(l)}$ 表示 $B^{-1}A$ 中第 $l$ 个分量不为 $0$ 的基向量（这样描述很抽象，事实上你可以理解为基向量表出是负责第 $l$ 个分量的那个基向量）。

首先新的基 $B' = (P'_{\pi(1)}, P'_{\pi(2)},...,P'_{\pi(l-1)},P'_{k},P'_{\pi(l+1)},...,P'_{\pi(m)})$ 显然是一个基，很容易注意到

$$
B' = BH
$$

其中 $H$ 是一个单位矩阵，除了第 $l$ 列为 $(\alpha_{1k},...,\alpha(mk))^T$ ，要使得 $B'$ 可行，须有 $B'^{-1}b$ 的每一个分量大于或等于 $0$ 。很容易发现，

$$
B'^{-1}b = H^{-1}B^{-1}b = H^{-1}\beta
$$

显然 $H^{-1}$ 是一个单位矩阵，除了第 $l$ 列为 $(-\frac{\alpha_{1k}}{\alpha_{lk}},...,-\frac{\alpha_{l-1,k}}{\alpha_{lk}}, \frac{1}{\alpha_{lk}}, -\frac{\alpha_{l+1,k}}{\alpha_{lk}}, ..., -\frac{\alpha_{mk}}{\alpha_{lk}})^T$ ，令 $\beta' = B'^{-1}b$ ，则

$$
\begin{equation}
\beta'_i = \left\{
    \begin{array}{cl}
    \beta_i - \frac{\alpha_{ik}\beta_l}{\alpha_{lk}}, i \ne l \\
    \frac{\beta_l}{\alpha_{lk}}, i = l
    \end{array} \right.
\end{equation}
$$

令每个分量大于等于零，得

$$
\frac{\beta_l}{\alpha_{lk}} \le \frac{\beta_i}{\alpha_{ik}}, \alpha_{ik} > 0
$$

注意 $\alpha_{ik} \le 0$ 的，分量必然是大于等于零的。

因此，我们需要令

$$
\frac{\beta_l}{\alpha_{lk}} = min\{\frac{\beta_i}{\alpha_{ik}} | \alpha_{ik} > 0, 1\le i \le m\}
$$

进行基变换后，我们更新检验数和目标函数

$$
\begin{split}
\lambda'_{j} = \lambda_j - \lambda_k\alpha_{lj}/\alpha{lk}, 1 \le j \le n \\
z'_{0} = z_0 + \lambda_k\beta_l/\alpha_{lk}
\end{split}
$$

### 单纯形法的有限终止

基本可行解中基本变量的值都大于零的基本可行解称作**非退化的**，否则称作**退化的**。非退化的有可行解的线性规划问题，计算的每一步，基变换都会导致目标函数值严格下降，所以可行基不会重复出现，单纯形法一定会在有限步内种植。如果线性规划是退化的，则可能出现目标函数值不变，从而可能出现循环，计算永不终止。为了解决这个问题，可以使用**Bland规则**。

:::info Bland 规则
规则一：当有多个 $\lambda_j \lt 0$ 时，取对应的非基变量中下标最小的作为换如变量。
规则二：当有多个 $\theta_i = \beta_i/\alpha_{ik} (\alpha_{ik} \gt 0)$ 同时取得最小值时，取对应的基变量中下标最小的作为换出变量。
:::

## 对偶线性规划

对于线性规划

$$
\begin{split}
max c^Tx \\
s.t. Ax \le b \\
x \ge 0
\end{split}
$$

我们定义其对偶线性规划为

$$
\begin{split}
min b^Ty \\
s.t. A^T \ge c \\
y \ge 0
\end{split}
$$

线性规划及其对偶的解存在关系，以下定理成立

:::info 定理
设 $x$ 是原始规划的可行解， $y$ 是对偶规划的可行解，则恒有

$$
c^Tx \le b^Ty
$$
:::

:::info 定理
如果 $x$ 和 $y$ 分别是原始规划和对偶规划的可行解，且 $c^Tx = b^Ty$ ，则 $x$ 和 $y$ 分别是原始规划和对偶规划的最优解
:::

:::info 定理
如果原始规划有最优解，则对偶规划也有最优解，且他们的最优值相等。反之亦然。
:::

原始规划和对偶规划的解仅存在三种情况：

1. 都有最优解，且最优值相等
2. 一个有可行解且目标函数值无界，而另一个无可行解
3. 都没有可行解

其他的组合情况都不可能出现。

## 整数线性规划的分支限界算法

上述问题之求解，我们的变量不必是整数，但在许多情形下，我们可能需要对变量添加整数的要求，称为**整数线性规划**。共有以下三种问题

1. **纯整数线性规划**或**全整数线性规划**：要求所有变量都是整数
2. **混合整数线性规划**：只要求部分变量是整数
3. **0-1 型整数线性规划**：要求变量必须是 0 或 1

删除整数线性规划中的整数要求所得到的线性规划成为它的**松弛规划**，简称**松弛**。松弛规划得到的最优值是整数线性规划的界限，但不一定是其最优值。对此，我们可以通过分支限界方法求解。

具体的，对于一个整数线性规划问题，我们求解其松弛规划的最优值和最优解，最优解满足整数要求的，即为整数线型规划问题的最优解；否则，对于不符合整数要求的变量，设其最优解为 $x_1 = a_1$ ，则分别添加约束 $x_1 \le \lfloor a_1 \rfloor$ 和 $x_1 \ge \lfloor a_1 \rfloor + 1$ ，得到两个新的整数线性规划问题，通过类似的方法求解这两个，并应用分支限界的原则，设置得到符合整数要求的最优解对应的最优值为界。

# 最小费用流

本篇笔记记录最小费用流相关的笔记。

## 一些定义

在容量网络中添加每条边单位流量的费用，形成容量-费用网络，记作 $N = <V, E, c, w, s, t>$ 。可行流的费用为流的每条边的流量与该边的单位流量费用乘积的和。在所有流量为 $v_0$ 的可行流中，费用最小的称作流量 $v_0$ 的最小费用流。最小费用流问题即给定容量-费用网络 $N$ 和流量 $v_0$ ，求流量 $v_0$ 的最小费用流。

定义辅助容量-费用网络的辅助费用 $aw$ 为尚有流量可减的，加权重相反数于反向边；尚有流量可增的，权重不变。很容易证明，叠加新的可行流后的费用等于原费用加上辅助网络的费用。

定义容量-费用网络上的圈流为一系列边上的流量相等，为 $\delta$ ，但除了圈上的顶点之间的流量为 $0$ 的流， $\delta$ 为环流量。其基本性质是，不会带来网络流量的改变，但可能导致费用的改变。

可以证明，任意的不是零流的容量为0的可行流，都等于若干个圈流之和，于是，我们只需要找到一个不再有边的权重和为负的圈流的可行流，即找到了最小费用流。更进一步，可以证明，可行流是最小费用流当且仅当辅助网络不存在以辅助费用为权的负回路。

## 最小费用流的负回路算法

我们需要寻找负回路，这可以通过Floyd算法实现，其会在存在负回路是返回负回路，否则返回任意两点之间的最短路径。其基本思路是，使用动态规划的方法，考虑前 $k$ 个顶点作为中间点时，从 $i$ 到 $j$ 的最短路径，其应该为考虑 $k-1$ 时的 $i$ 到 $j$ 的最短路径和 $i$ 到 $k$ 再到 $j$ 的最短路径的较短者，从而求的所有点的最短路径。最后，我们判断是否存在 $i$ 到 $i$ 的最短路径，使得其为负数，如果存在，则检测到负回路。期间我们记录最短路径 $i$ 的下一个顶点的标号，从而能够恢复出最短路径或负回路。

最小费用流的负回路算法，即借助Floyd算法实现，调用最大流算法，求得流量为 $v_0$ 的可行流，如果最大流小于 $v_0$ 的，输出“无流量$v_0$的可行流”，否则构造辅助网络，检测负回路，存在的利用负回路构造圈流，环流量为辅助流量的最小值，循环往复，直至无法找到负回路为止。

## 最小费用流的最短路径算法

一个通常的想法是，我们从零流开始，在辅助网络上寻找费用最少的 $s-t$ 增广链，增加其流量，循环往复，直至流量达到要求的 $v_0$ 。费用最少的 $s-t$ 增广链，即以 $aw$ 为权的 $s-t$ 最短路径，可以调用 Floyd 算法获取，无负回路时，可以使用 Ford 算法获取。

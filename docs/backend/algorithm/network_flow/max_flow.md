# 最大流问题

这篇笔记记录最大流问题的笔记。

## 一些定义

通常用 $N=<V,E,c,s,t>$ 表示一个容量网络，其中 $n = |V|$, $m = |E|$ ， $c$ 表示边的容量， $s$ 表示发点或源， $t$ 表示收点或汇，其余的顶点称为中间点。可行流为满足容量限制和平衡条件的流， $s$ 的净流出量称为 $f$ 的流量，记作 $v(f)$ ，流量最大的可行流称作最大流。最大流问题即求给定容量网络的最大流。

将容量网络分为两个部分，且使得发点（$s$）和收点（$t$）不在同一部分，这两部分分别为 $A$ 和 $\bar{A}$ ，其中 $s\in A$ ， $t\in \bar{A}$ ，记 $(A, \bar{A})$ 为从 $A$ 到 $\bar{A}$ 的边的集合，则 $(A, \bar{A})$ 称为 $N$ 的一个割集，两个部分之间的容量称为割集的容量，容量最小的割集称作最小割集。

很容易注意到，可行流的流量一定不超过割集的容量，于是，最大可行流的流量等与最小割集的容量。

## Ford-Fulkerson 算法

考虑一个容量网络 $N=<V,E,c,s,t>$ ， $f$ 是 $N$ 上的一个可行流，流量等于容量的称为饱和边，否则为非饱和边；流量等于 $0$ 的称为零流边，否则称为非零流边。定义顶点 $i$ 到 $j$ 的一条边不重复的路径为 $i-j$ 链，方向从 $i$ 到 $j$ ，链中与链方向相同的边称为前向边，相反的称为后向边，如果前向边都是非饱和的，后向边都是非零流的，则这条链称为 $i-j$ 增广链。

通俗的理解， $i-j$ 增广链即一条前向边还可以增加流量、后向边还可以减少流量的链。很容易注意到，对于 $s-t$ 增广链（ $s$ 表示发点， $t$ 表示收点），如果增加前向边容量，减少后向边容量，则可以增大网络流，所以网络流 $f$ 是最大流的充分必要条件是不存在关于 $f$ 的 $s-t$ 增广链。

所谓 Ford-Fulkerson 算法，即是根据这一原理设计的，其基本思想是，对于一个初始的可行流（通常是零流），寻找 $s-t$ 增广链，最大程度上的增加流量（即增广链上可变流量的最小值），循环往复，直至没有 $s-t$ 增广链为止。其中核心的一个问题是 $s-t$ 增广链的寻找， Ford-Fulkerson 算法的方法是进行搜索，我们会标记从 $s$ 到每个顶点的增广链（如果存在的话），每次从找到增广链的顶点开始向外扩展，即检查其有边关联的顶点，直至找到 $t$ ，期间需要记录到这个顶点的增广链的最后一条边（即与该顶点相连的边）是前向边还是后向边、上一个顶点以及增广链可变动流量的最小值。注意我们可能覆盖找到增广链的顶点的标记。

FF算法的时间复杂度是 $O(mC)$ ，其中 $m$ 为边的条数， $C$ 为从 $s$ 出发的所有边的容量的和。FF算法有限终止需要要求容量都是整数。

## Dinic 有效算法

定义辅助网络 $N(f)$ ，其形象化定义为一个容量网络 $N$ 与可行流 $f$ ，将可行流每条边的容量减去流量，并增加一条反向的、容量等于流量的边，构成的新的容量网络，新容量为 $0$ 的不予保留。新的容量通常记为 $ac$ ，称作辅助容量。很容易注意到，辅助网络的最大流量为原网络的最大流量减去可行流的流量。如果辅助网络存在可行流，则可以叠加到原网络上，新的可行流流量为原可行流流量加上辅助网络可行流流量，叠加方法为对于每一条原网络的边，流量加上辅助网络同向的流量，而减去反向的流量。

辅助网络形象的理解就是，前向的边表示了该边可以增加的流量，后向的边表示了该边可以减少的流量，原来的网络也可以理解为零流的辅助网络，由于流量非负，故没有可以减少的流量，因而两个顶点只有一个方向的边，容量表示的就是可以增加的流量，前向的边的容量即为容量。

辅助网络的可行流即对应原网络的增广链，最大流问题变成了我们需要使得辅助网络没有可行流。 Dinic 有效算法即依托于此。

Dinic 有效算法使用广度优先搜索的方法取得最短的 $s-t$ 增广链，以改进 [FF 算法](#ford-fulkerson-算法)，为此，我们按照到 $s$ 的最小距离分层，并去除从更远顶点到更近顶点的边，以及距离比 $t$ 更远的顶点及其相关的边，形成分层辅助网络。在分层辅助网络上，我们可以注意到，所有的从 $s$ 到 $t$ 的链长度都是相等的，且是原网络中最短的。我们不仅是寻找一条增广链，二是希望增加一次流量，而不限于在一条增广链上增加，这里我们使用极大流的方法。

所谓极大流，即使得容量网络不存在都是前向边的增广链的可行流。极大流不一定是可行流，但可行流一定是极大流。我们考虑每个顶点的流通量，其定义为可以通过该顶点的最大流量，即为流向其的容量之和和流出的容量之和的较小值。每次确定流通量最小的顶点，将这样大小的流量向前推送到 $t$ ，向后推送到 $s$ ，构成一个可行流，循环往复，加总得到极大流。将极大流叠加到原始的可行流上，构造新的辅助网络和分层辅助网络，循环往复，直至分层辅助网络没有可行流。

Dinic算法的实践复杂度为 $O(n^3)$ ，对于简单容量网络（边的容量为1,中间点或入度为1,或出度为1），时间复杂度为 $O(n^{1/2})$ 。
